---
apiVersion: batch/v1
kind: Job
metadata:
  name: {{ .Release.Name }}-kaapana-plugin
  namespace: {{ .Values.global.flow_namespace }}
spec:
  template:
    spec:
      containers:
      - name: kaapana-plugin
        image: {{  .Values.global.registry_url }}{{  .Values.global.registry_project }}/kaapana-plugin:0.8-vdev
        imagePullPolicy:  {{ .Values.global.pull_policy_operators }}
        volumeMounts:
        - name: data
          mountPath: "/mount_data"
      volumes:
      - name: data
        hostPath:
          path: {{ .Values.global.fast_data_dir }}/workflows
          type: DirectoryOrCreate
      restartPolicy: Never
      imagePullSecrets:
      - name: camic-registry
  backoffLimit: 0